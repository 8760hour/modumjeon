<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!--  SQL Mapping 설정 -->
<mapper namespace="board">
    <!--  SQL 객체 -->
    <!--    게시글 목록 -->
    <select id="getBoardList" resultType="BoardDto">
        select BoardId, B_Writer, B_Title, B_Date, B_Count
        from Board
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <if test="searchType=='title' and keyword != null and keyword != '' ">
                AND TITLE like CONCAT('%', #{keyword}, '%')
            </if>
            <if test="searchType=='content' and keyword != null and keyword != '' ">
                AND CONTENT like CONCAT('%', #{keyword}, '%')
            </if>
            <if test="searchType=='reg_id' and keyword != null and keyword != '' ">
                AND reg_id like CONCAT('%', #{keyword}, '%')
            </if>
        </trim>
    </select>

    <!--    페이징-->
    <!-- 총 게시글 갯수 출력 -->
    <select id="getBoardListCnt" parameterType="int" resultType="int">
        SELECT COUNT(*)
        FROM BOARD
        <trim prefix="WHERE" prefixOverrides="AND|OR">
            <if test="searchType=='title' and keyword != null and keyword != '' ">
                AND TITLE like CONCAT('%', #{keyword}, '%')
            </if>
            <if test="searchType=='content' and keyword != null and keyword != '' ">
                AND CONTENT like CONCAT('%', #{keyword}, '%')
            </if>
            <if test="searchType=='reg_id' and keyword != null and keyword != '' ">
                AND reg_id like CONCAT('%', #{keyword}, '%')
            </if>
        </trim>
    </select>

    <!-- 페이징 처리 후 게시글 조회 -->
    <!-- 파라미터 타입 변경 -> dto로 -->
    <select id="selectBoard" parameterType="BoardDto" resultType="BoardDto">
        SELECT BoardId, B_Writer, B_Title, B_Date, B_Count
        FROM Board
        ORDER BY BoardId DESC
        OFFSET (#{curPage} -1) * 15 ROWS
        FETCH NEXT 15 ROWS ONLY
    </select>

    <!--    게시글 작성-->
    <insert id="insert" parameterType="BoardDto">
        INSERT INTO Board(B_Writer, B_Password, B_Title, B_Context, B_Count)
        VALUES (#{B_Writer}, #{B_Password}, #{B_Title}, #{B_Context}, 0)

    </insert>

    <!--    게시글 상세보기-->
    <select id="pageDetail" resultType="BoardDto">
        SELECT *
        FROM Board
        WHERE BoardId = #{BoardId}
    </select>

    <!--    조회수 증가-->
    <update id="increaseCount" parameterType="java.lang.Integer">
        UPDATE Board
        SET B_Count = B_Count + 1
        WHERE BoardId = #{BoardId}
    </update>

    <!--    게시글 삭제-->
    <delete id="delete" parameterType="int">
        DELETE FROM board
        WHERE BoardId = #{BoardId}
    </delete>

    <!--    게시글 수정-->
    <update id="update" parameterType="BoardDto">
        UPDATE Board
        SET B_Title = #{B_Title},
            B_Context = #{B_Context}
        WHERE BoardId = #{BoardId}
    </update>
</mapper>